# SymClosestWannier

A Python library to create Symmetry-adapted Closest Wannier (SymCW) tight-binding models based on the Symmetry-Adapted Multipole Basis (SAMB) [1] and the Closest Wannier formalism developed by Taisuke Ozaki [2].


[1] Hiroaki Kusunose, Rikuto Oiwa, and Satoru Hayami, Symmetry-adapted modeling for molecules and crystals, Phys. Rev. B 107, 195118 (2023).

DOI: https://doi.org/10.1103/PhysRevB.107.195118.

[2] Taisuke Ozaki, arXiv:2306.15296, (2023).

URL: https://arxiv.org/abs/2306.15296v2.


## Installation

SymClosestWannier can be installed from PyPI using pip on Python >= 3.9:
```
pip install symclosestwannier
```
You can also visit
[PyPI](https://pypi.org/project/symclosestwannier/) ors [GitHub](https://github.com/CMT-MU/SymClosestWannier/) to download the source.


## Authors

Rikuto Oiwa


## Citing SymClosestWannier

If you are using SymClosestWannier in your scientific research, please help our scientific visibility by citing our work:

> Rikuto Oiwa, Akane Inda, Satoru Hayami, Takuya Nomoto, Ryotaro Arita, and Hiroaki Kusunose, in preparation.
>
> DOI: []()


## Requirements
- Symmetry-Adapted Multipole Basis (SAMB) for molecules or crystals are optionally generated by [MultiPie](https://github.com/CMT-MU/MultiPie).
- MultiPie library optionally requires [TeXLive](https://www.tug.org/texlive/) environment to create LaTeX and PDF files.
- Molecular or crystal structure files are optionally generated by [QtDraw](https://github.com/CMT-MU/QtDraw).


## Construction of SAMBs (if symmetrization is not required, this procedure is not necessary)

1. Prepare input file. Example input files for [CH4](example/ch4.py) molecule and [graphene](example/graphene.py) are given here.
    ```python
    # ch4.py
    ch4 = {
        "model": "ch4",  # name of model.
        "group": "Td",  # name of point group.
        "cell": {"c": 10},  # set large enough interlayer distance.
        #
        "site": {"C": ("[0,0,0]", "s p"), "H": ("[1/3,1/3,1/3]", "s")},  # positions of C and H sites and their orbitals.
       "bond": [("C", "H", 1), ("H", "H", 1)],  # nearest-neighbor C-H and H-H bonds.
        #
        "spinful": True,  # spinful.
    }
    ```
    ```python
    # graphene.py
    graphene = {
        "model": "graphene",  #  name of model.
        "group": 191,  # No. of space group.
        "cell": {"a": 2.435, "b": 2.435, "c": 1000},  # set large enough interlayer distance.
        #
        "site": {"C": ("[2/3,1/3,0]", "pz")},  # positions of C site and its orbital.
        "bond": [("C", "C", [1, 2, 3, 4, 5, 6])],  # C-C bonds up to 6th neighbors.
        #
        "spinful": False,  # spinless.
        #
        "k_point": {"Γ": "[0,0,0]", "K": "[1/3,1/3,0]", "M": "[1/2,0,0]"},
        "k_path": "Γ-M-K-Γ",
    }
    ```
2. At the folder where these two input files exist, do the following to create SAMB.
See for more detail, try "**create_samb --help**" command.
    ```
    $ create_samb ch4 graphene
    ```
3. The following files are created in **ch4** and **graphene** folders.
    - ch4_model.py, ch4_samb.py, ch4_matrix.py, ch4_samb.tex, ch4_samb.pdf, ch4_view.qtdw
    - graphene_model.py, graphene_samb.py, graphene_matrix.py, graphene_samb.tex, graphene_samb.pdf, graphene_view.qtdw

    Here, **.tex** and **.pdf** are created if [TeXLive](https://www.tug.org/texlive/) is installed, and **.qtdw** is created if [QtDraw](https://github.com/CMT-MU/QtDraw) is installed.

    Each file contains
    - **_model.py** : model information.
    - **_samb.py** : detailed information on SAMB.
    - **_matrix.py** : full-matrix form of SAMB.
    - **_samb.tex** and **_samb.pdf** : detailed information on SAMB in LaTeX and PDF format.
    - **_view.qtdw** : molecular or crystal structure file for QtDraw.

See for more detaied file formats [MultiPie](https://github.com/CMT-MU/MultiPie).


## Construction of SymCW tight-binding model

1. Calculate overlapes between Kohn-Sham orbitals and pseudo atomic orbitals based on the Plane-Wave (PW) DFT calculation softwares, such as [QuantumEspresso](https://www.quantum-espresso.org/) and [VASP](https://www.vasp.at/).
    - seedname.win, seedname.amn, seedname.eig, seedname.mmn, seedname.nnkp (generated by [Wannier90](https://wannier.org/))
    (additional files: seedname.spn, seedname.uHu, seedname.uIu, ...)

    are used for the next step.

2. Prepare input file for construction of SymCW tight-binding model. Example input files for [CH4](example/ch4.cwin) molecule and [graphene](example/graphene.cwin) are given here.
    ```
    # ch4.cwin
    restart = cw ! 'cw'/'w90'/'sym'

    outdir = './'

    disentangle = false
    proj_min    = 0.5
    verbose     = true

    write_hr          = .true.
    write_sr          = .true.
    write_u_matrices  = .true.
    write_rmn         = .true.
    write_vmn         = .true.
    write_tb          = .true.

    # symmetrization
    symmetrization = true
    mp_outdir      = './'
    mp_seedname    = ch4
    ket_amn        = [(s,U)@C_1,(s,D)@C_1,(pz,U)@C_1,(pz,D)@C_1,(px,U)@C_1,(px,D)@C_1,(py,U)@C_1,(py,D)@C_1,(s,U)@H_1,(s,D)@H_1,(s,U)@H_2,(s,D)@H_2,(s,U)@H_3,(s,D)@H_3,(s,U)@H_4,(s,D)@H_4]
    irreps         = full
    ```
    ```
    # graphene.cwin
    restart = cw ! 'cw'/'w90'/'sym'

    outdir = './'

    disentangle       = true
    proj_min          = 0.2
    dis_win_emax      = 10
    dis_win_emin      = -30
    smearing_temp_max = 0.1
    smearing_temp_min = 1e-6
    delta             = 1e-12
    svd               = true
    verbose           = true

    write_hr          = .true.
    write_sr          = .true.
    write_u_matrices  = .true.
    write_rmn         = .true.
    write_vmn         = .true.
    write_tb          = .true.

    N1 = 50

    # symmetrization
    symmetrization = true
    mp_outdir      = './'
    mp_seedname    = graphene
    ket_amn        = [pz@C_1,pz@C_2]
    irreps         = full ! full/all/list
    ```

3. At the folder where these two input files exist, do the following to create SymCW tight-binding models.
See for more detail, try "**pw2cw --help**" command.
    ```
    $ cd example/ch4
    $ pw2cw ch4

    $ cd example/graphene
    $ pw2cw graphene
    ```
1. The following files are created in **ch4** and **graphene** folders.
    - ch4.cwout, ch4_info.py, ch4_data.py, ch4_hr.dat, ch4_sr.dat, ch4_hr_sym.dat, ch4_sr_sym.dat, ch4_z.dat, ch4_s.dat, ch4_r.dat, ch4_v.dat, ch4_tb.dat, ch4_u.mat, ch4_u_dis.mat.
    - graphene.cwout, graphene_info.py, graphene_data.py, graphene_hr.dat, graphene_sr.dat, graphene_hr_sym.dat, graphene_sr_sym.dat, graphene_z.dat, graphene_s.dat, graphene_r.dat, graphene_v.dat, graphene_tb.dat, graphene_u.mat, graphene_u_dis.mat.

    Each file contains
    - **seedname_cwin** : input.
    - **seedname_cwout** : standard output.
    - **seedname_info.py** : calculation information for CWModel.
    - **seedname_data.py** : calculation data for SymCW.
    - **seedname_hr.dat** (**_hr_sym.dat**): (Symmetrized) Hamiltonian matrix elements in real-space.
    - **seedname_sr.dat** (**_hr_sym.dat**): (Symmetrized) Overlap matrix elements in real-space.
    - **seedname_z.dat** : The expansion coefficients of the Hamiltonian matrix expressed by a linear combination of SAMBs.
    - **seedname_s.dat** : The expansion coefficients of the Overlap matrix expressed by a linear combination of SAMBs.
    - **seedname_band.txt** : band dispersion data of SymCW tight-binding model.
    - **plot_band.gnu** : gnuplot file for plotting band dispersion.
    - **seedname_band.eps** : gnuplot file for plotting band dispersion.

The detailed file formats are given as follows:
- [seedname.cwin](fmt_cwin.md)
- [seedname.cwout](fmt_cwout.md)
- [seedname_info.py](fmt_info.md)
- [seedname_data.py](fmt_data.md)
- [seedname_hr.dat](fmt_hr.md)
- [seedname_sr.dat](fmt_sr.md)
- [mp_seedname_z.dat](fmt_z.md)
- [mp_seedname_s.dat](fmt_s.md)

## Examples

```
cd others/examples
python run_examples.py
```
